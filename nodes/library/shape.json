{
  "id": "SHAPE",
  "label": "Shape",
  "category": "Generator",
  "description": "Generates a procedural shape mask (Substance-style).",
  "locales": {
    "zh": {
      "Shape": "形状",
      "Generates a procedural shape mask (Substance-style).": "生成程序化形状遮罩（Substance 风格）。",

      "Shape Type": "形状类型",
      "Square": "方形",
      "Disc": "圆形",
      "Paraboloid": "抛物面",
      "Bell": "钟形",
      "Gaussian": "高斯",
      "Thorn": "尖刺",
      "Pyramid": "金字塔",
      "Brick": "砖形",
      "Gradation": "渐变",
      "Waves": "波浪",
      "Half Bell": "半钟形",
      "Ridged Bell": "棱脊钟形",
      "Crescent": "新月",
      "Capsule": "胶囊",
      "Cone": "圆锥",
      "Hemisphere": "半球",
      "Polygon": "多边形",

      "Polygon Sides": "多边形边数",
      "Size": "大小",
      "Size XY": "大小(宽/高)",
      "Rotation": "旋转",

      "Result": "结果"
    }
  },
  "data": {
    "glsl": [
      "// Procedural Shape (Substance-style)\n// Outputs a grayscale mask in rgb and alpha.",
      "",
      "#define PI 3.1415926535897932384626433832795",
      "",
      "vec2 rot2(vec2 p, float a) {",
      "    float c = cos(a), s = sin(a);",
      "    return mat2(c, -s, s, c) * p;",
      "}",
      "",
      "float sdBox(vec2 p, vec2 b) {",
      "    vec2 d = abs(p) - b;",
      "    return length(max(d, vec2(0.0))) + min(max(d.x, d.y), 0.0);",
      "}",
      "",
      "float sdRoundBox(vec2 p, vec2 b, float r) {",
      "    vec2 q = abs(p) - b;",
      "    return length(max(q, vec2(0.0))) + min(max(q.x, q.y), 0.0) - r;",
      "}",
      "",
      "float sdCircle(vec2 p, float r) {",
      "    return length(p) - r;",
      "}",
      "",
      "float sdCapsule(vec2 p, vec2 a, vec2 b, float r) {",
      "    vec2 pa = p - a;",
      "    vec2 ba = b - a;",
      "    float h = clamp(dot(pa, ba) / dot(ba, ba), 0.0, 1.0);",
      "    return length(pa - ba * h) - r;",
      "}",
      "",
      "float sdRegularPolygon(vec2 p, int sides, float r) {",
      "    int n = max(3, sides);",
      "    float an = 2.0 * PI / float(n);",
      "    float ang = atan(p.y, p.x);",
      "    float l = length(p);",
      "    float k = cos(floor(0.5 + ang / an) * an - ang);",
      "    return l * k - r;",
      "}",
      "",
      "float aaStep(float d) {",
      "    float w = fwidth(d);",
      "    return 1.0 - smoothstep(0.0, w, d);",
      "}",
      "",
      "void run(",
      "    vec2 uv,",
      "    int shape,",
      "    int polygon_sides,",
      "    float size,",
      "    vec2 size_xy,",
      "    float rotation,",
      "    out float result",
      ") {",
      "    // Local space centered at 0.5, with rotation applied.",
      "    float a = radians(rotation);",
      "    vec2 p = uv - vec2(0.5);",
      "    p = rot2(p, a);",
      "",
      "    // Size handling: size is a global multiplier, size_xy controls aspect (width/height).",
      "    float s = max(1e-4, size);",
      "    vec2 sxy = max(vec2(1e-4), abs(size_xy));",
      "    vec2 q = p / (s * sxy);",
      "",
      "    // Common radial terms (normalized so r=1 at disc boundary).",
      "    float r01 = length(q) / 0.5;",
      "    float rClamp = clamp(r01, 0.0, 1.0);",
      "    float edge = 1.0 - smoothstep(1.0 - fwidth(r01), 1.0 + fwidth(r01), r01);",
      "    float disc = aaStep(sdCircle(q, 0.5));",
      "",
      "    float v = 0.0;",
      "",
      "    // Shape IDs:",
      "    // 0 Square, 1 Disc, 2 Paraboloid, 3 Bell, 4 Gaussian, 5 Thorn, 6 Pyramid, 7 Brick,",
      "    // 8 Gradation, 9 Waves, 10 Half Bell, 11 Ridged Bell, 12 Crescent, 13 Capsule,",
      "    // 14 Cone, 15 Hemisphere, 16 Polygon",
      "",
      "    if (shape == 0) {",
      "        float d = sdBox(q, vec2(0.5));",
      "        v = aaStep(d);",
      "    } else if (shape == 1) {",
      "        float d = sdCircle(q, 0.5);",
      "        v = aaStep(d);",
      "    } else if (shape == 2) {",
      "        // Paraboloid: 1 - r^2",
      "        v = max(0.0, 1.0 - rClamp * rClamp) * edge;",
      "    } else if (shape == 3) {",
      "        // Bell: cosine falloff",
      "        v = (0.5 + 0.5 * cos(PI * rClamp)) * edge;",
      "    } else if (shape == 4) {",
      "        // Gaussian",
      "        v = exp(-4.0 * rClamp * rClamp) * edge;",
      "    } else if (shape == 5) {",
      "        // Thorn: sharper cone-like profile",
      "        float t = max(0.0, 1.0 - rClamp);",
      "        v = pow(t, 4.0) * edge;",
      "    } else if (shape == 6) {",
      "        // Pyramid (square): 1 - max(|x|,|y|)",
      "        float m = max(abs(q.x), abs(q.y)) / 0.5;",
      "        float t = clamp(1.0 - m, 0.0, 1.0);",
      "        float e = 1.0 - smoothstep(1.0 - fwidth(m), 1.0 + fwidth(m), m);",
      "        v = t * e;",
      "    } else if (shape == 7) {",
      "        // Brick: rounded rectangle",
      "        float d = sdRoundBox(q, vec2(0.5, 0.35), 0.06);",
      "        v = aaStep(d);",
      "    } else if (shape == 8) {",
      "        // Gradation: left->right ramp in local domain",
      "        float u = q.x / 0.5; // [-1,1]",
      "        v = clamp(0.5 + 0.5 * u, 0.0, 1.0);",
      "    } else if (shape == 9) {",
      "        // Waves: 3 vertical wave bands, circularly masked (Substance-style thumbnail)",
      "        float x01 = clamp((q.x / 0.5) * 0.5 + 0.5, 0.0, 1.0);",
      "        float s3 = sin(PI * 3.0 * x01);",
      "        float bands = s3 * s3;",
      "        v = bands * disc;",
      "    } else if (shape == 10) {",
      "        // Half Bell: 1D bell on X, kept only on the right half, circularly masked",
      "        float u = q.x / 0.5; // [-1,1]",
      "        float t = clamp(u, 0.0, 1.0);",
      "        float bell = 0.5 + 0.5 * cos(PI * t);",
      "        float halfMask = smoothstep(-fwidth(u), fwidth(u), u);",
      "        v = bell * halfMask * disc;",
      "    } else if (shape == 11) {",
      "        // Ridged Bell: narrow center ridge (1D profile), circularly masked",
      "        float u = abs(q.x) / 0.5;",
      "        float t = clamp(1.0 - u, 0.0, 1.0);",
      "        v = pow(t, 6.0) * disc;",
      "    } else if (shape == 12) {",
      "        // Crescent: disc minus shifted disc",
      "        float d0 = sdCircle(q, 0.5);",
      "        float d1 = sdCircle(q - vec2(0.22, 0.0), 0.5);",
      "        float m0 = aaStep(d0);",
      "        float m1 = aaStep(d1);",
      "        v = clamp(m0 - m1, 0.0, 1.0);",
      "    } else if (shape == 13) {",
      "        // Capsule (horizontal)",
      "        float d = sdCapsule(q, vec2(-0.30, 0.0), vec2(0.30, 0.0), 0.20);",
      "        v = aaStep(d);",
      "    } else if (shape == 14) {",
      "        // Cone: linear falloff",
      "        v = max(0.0, 1.0 - rClamp) * edge;",
      "    } else if (shape == 15) {",
      "        // Hemisphere: sqrt(1 - r^2)",
      "        v = sqrt(max(0.0, 1.0 - rClamp * rClamp)) * edge;",
      "    } else if (shape == 16) {",
      "        float d = sdRegularPolygon(q, polygon_sides, 0.5);",
      "        v = aaStep(d);",
      "    }",
      "",
      "    v = clamp(v, 0.0, 1.0);",
      "    result = v;",
      "}"
    ],
    "inputs": [
      { "id": "shape", "name": "Shape Type", "type": "int" },
      { "id": "polygon_sides", "name": "Polygon Sides", "type": "int" },
      { "id": "size", "name": "Size", "type": "float" },
      { "id": "size_xy", "name": "Size XY", "type": "vec2" },
      { "id": "rotation", "name": "Rotation", "type": "float" }
    ],
    "outputs": [
      { "id": "result", "name": "Result", "type": "float" }
    ],
    "outputType": "float",
    "uniforms": {
      "shape": {
        "type": "int",
        "value": 1,
        "widget": "enum",
        "widgetConfig": {
          "enumOptions": [
            { "label": "Square", "value": 0 },
            { "label": "Disc", "value": 1 },
            { "label": "Paraboloid", "value": 2 },
            { "label": "Bell", "value": 3 },
            { "label": "Gaussian", "value": 4 },
            { "label": "Thorn", "value": 5 },
            { "label": "Pyramid", "value": 6 },
            { "label": "Brick", "value": 7 },
            { "label": "Gradation", "value": 8 },
            { "label": "Waves", "value": 9 },
            { "label": "Half Bell", "value": 10 },
            { "label": "Ridged Bell", "value": 11 },
            { "label": "Crescent", "value": 12 },
            { "label": "Capsule", "value": 13 },
            { "label": "Cone", "value": 14 },
            { "label": "Hemisphere", "value": 15 },
            { "label": "Polygon", "value": 16 }
          ]
        }
      },
      "polygon_sides": {
        "type": "int",
        "value": 6,
        "widget": "slider",
        "widgetConfig": {
          "min": 3,
          "max": 12,
          "step": 1,
          "visibleIf": { "uniform": "shape", "value": 16 }
        }
      },
      "size": { "type": "float", "value": 1.0, "widget": "slider", "widgetConfig": { "min": 0.05, "max": 2.0, "step": 0.01 } },
      "size_xy": { "type": "vec2", "value": [1.0, 1.0], "widget": "default" },
      "rotation": { "type": "float", "value": 0.0, "widget": "angle", "widgetConfig": { "min": -180.0, "max": 180.0, "step": 1.0 } }
    }
  }
}
