{
  "id": "BEVEL_EMBOSS",
  "label": "Bevel & Emboss",
  "category": "Filter",
  "locales": {
    "zh": {
      "Bevel & Emboss": "斜面和浮雕",
      "Input": "输入",
      "Style": "样式",
      "Inner Bevel": "内斜面",
      "Outer Bevel": "外斜面",
      "Emboss": "浮雕效果",
      "Pillow Emboss": "枕状浮雕",
      "Depth": "深度 (%)",
      "Size": "大小 (px)",
      "Soften": "软化 (px)",
      "Angle": "角度",
      "Altitude": "高度",
      "Highlight Opacity": "高光不透明度",
      "Shadow Opacity": "阴影不透明度",
      "Highlight Color": "高光颜色",
      "Shadow Color": "阴影颜色",
      "Direction": "方向",
      "Up": "上",
      "Down": "下",
      "Highlight Mode": "高光模式",
      "Shadow Mode": "阴影模式",
      "Normal": "正常",
      "Multiply": "正片叠底",
      "Screen": "滤色",
      "Overlay": "叠加",
      "Linear Dodge": "线性减淡 (添加)",
      "Linear Burn": "线性加深",
      "Contour": "等高线",
      "Technique": "方法",
      "Smooth": "平滑",
      "Chisel Hard": "雕刻清晰",
      "Chisel Soft": "雕刻柔和",
      "Texture": "纹理",
      "Texture Depth": "纹理深度"
    }
  },
  "data": {
    "glsl": [
      "vec3 blendNormal(vec3 base, vec3 blend) {",
      "    return blend;",
      "}",
      "",
      "vec3 blendMultiply(vec3 base, vec3 blend) {",
      "    return base * blend;",
      "}",
      "",
      "vec3 blendScreen(vec3 base, vec3 blend) {",
      "    return 1.0 - (1.0 - base) * (1.0 - blend);",
      "}",
      "",
      "vec3 blendOverlay(vec3 base, vec3 blend) {",
      "    return mix(2.0 * base * blend, 1.0 - 2.0 * (1.0 - base) * (1.0 - blend), step(0.5, base));",
      "}",
      "",
      "vec3 blendLinearDodge(vec3 base, vec3 blend) {",
      "    return min(base + blend, 1.0);",
      "}",
      "",
      "vec3 blendLinearBurn(vec3 base, vec3 blend) {",
      "    return max(base + blend - 1.0, 0.0);",
      "}",
      "",
      "vec3 applyBlend(int mode, vec3 base, vec3 blend) {",
      "    if (mode == 0) return blendNormal(base, blend);",
      "    if (mode == 1) return blendMultiply(base, blend);",
      "    if (mode == 2) return blendScreen(base, blend);",
      "    if (mode == 3) return blendOverlay(base, blend);",
      "    if (mode == 4) return blendLinearDodge(base, blend);",
      "    if (mode == 5) return blendLinearBurn(base, blend);",
      "    return blend;",
      "}",
      "",
      "float getSample(sampler2D tex, vec2 uv, float soften) {",
      "    if (soften <= 0.1) return texture(tex, uv).a;",
      "    ",
      "    float total = 0.0;",
      "    float totalWeight = 0.0;",
      "    ",
      "    // 16x16 Gaussian Blur (256 samples)",
      "    for(float i = 0.0; i < 16.0; i++) {",
      "        float x = (i / 15.0) * 2.0 - 1.0;",
      "        for(float j = 0.0; j < 16.0; j++) {",
      "            float y = (j / 15.0) * 2.0 - 1.0;",
      "            ",
      "            float d2 = x*x + y*y;",
      "            float w = exp(-d2 * 2.0);",
      "            ",
      "            vec2 offset = vec2(x, y) * (soften / u_resolution);",
      "            total += texture(tex, uv + offset).a * w;",
      "            totalWeight += w;",
      "        }",
      "    }",
      "    ",
      "    return total / totalWeight;",
      "}",
      "",
      "void run(vec2 uv, sampler2D inputTex, int style, int technique, float depth, float size, float soften, float angle, float altitude, float hiOpacity, float shOpacity, vec3 hiColor, vec3 shColor, int direction, int hiMode, int shMode, sampler2D contour, sampler2D detailTex, float detailDepth, out vec4 result, out vec4 normalOut) {",
      "    vec4 original = texture(inputTex, uv);",
      "    ",
      "    float hCenter = getSample(inputTex, uv, soften);",
      "    ",
      "    // 1. Calculate Light Vector",
      "    float rad = radians(angle);",
      "    float altRad = radians(clamp(altitude, 0.0, 89.0));",
      "    vec3 lightDir = vec3(cos(rad) * cos(altRad), sin(rad) * cos(altRad), sin(altRad));",
      "    ",
      "    // 2. 16-Direction Sampling for Gradient",
      "    vec2 gradient = vec2(0.0);",
      "    ",
      "    if (technique == 0) { // Smooth",
      "        for(int i=0; i<16; i++) {",
      "            float theta = float(i) * (6.2831853 / 16.0);",
      "            vec2 dir = vec2(cos(theta), sin(theta));",
      "            vec2 offset = dir * (size / u_resolution);",
      "            float hSample = getSample(inputTex, uv + offset, soften);",
      "            gradient += dir * (hCenter - hSample);",
      "        }",
      "        gradient /= 8.0;",
      "    } else { // Chisel Hard (1) & Chisel Soft (2)",
      "        float maxDiff = 0.0;",
      "        vec2 maxDir = vec2(0.0);",
      "        float sampleSoften = (technique == 2) ? soften : 0.0;",
      "        ",
      "        for(int i=0; i<16; i++) {",
      "            float theta = float(i) * (6.2831853 / 16.0);",
      "            vec2 dir = vec2(cos(theta), sin(theta));",
      "            vec2 offset = dir * (size / u_resolution);",
      "            float hSample = getSample(inputTex, uv + offset, sampleSoften);",
      "            float diff = hCenter - hSample;",
      "            if (abs(diff) > abs(maxDiff)) {",
      "                maxDiff = diff;",
      "                maxDir = dir;",
      "            }",
      "        }",
      "        gradient = maxDir * maxDiff;",
      "    }",
      "    ",
      "    // Apply Detail Texture (Bump Mapping)",
      "    if (detailDepth != 0.0) {",
      "        float dCenter = texture(detailTex, uv).r;",
      "        float dOffset = 1.0 / u_resolution.x;",
      "        float dRight = texture(detailTex, uv + vec2(dOffset, 0.0)).r;",
      "        float dUp = texture(detailTex, uv + vec2(0.0, dOffset)).r;",
      "        vec2 detailGrad = vec2(dCenter - dRight, dCenter - dUp) * detailDepth;",
      "        gradient += detailGrad;",
      "    }",
      "    ",
      "    // Style Adjustments",
      "    if (style == 3) gradient = -gradient;",
      "    if (direction == 1) gradient = -gradient;",
      "    ",
      "    // 3. Calculate Normal & Intensity",
      "    float depthFactor = depth / 100.0;",
      "    vec3 normal = normalize(vec3(gradient * depthFactor * 5.0, 1.0));",
      "    float ndotl = dot(normal, lightDir);",
      "    ",
      "    // 4. Apply Contour",
      "    float t = ndotl * 0.5 + 0.5;",
      "    float contoured = texture(contour, vec2(t, 0.5)).r;",
      "    float intensity = contoured * 2.0 - 1.0;",
      "    ",
      "    // 5. Determine Mask",
      "    float mask = 0.0;",
      "    if (style == 0) { // Inner",
      "        mask = original.a;",
      "    } else if (style == 1) { // Outer",
      "        mask = 1.0 - original.a;",
      "    } else { // Emboss (2) & Pillow (3)",
      "        mask = 1.0;",
      "    }",
      "    ",
      "    // Soften mask for Outer/Emboss",
      "    float edgePresence = smoothstep(0.0, 0.1, length(gradient));",
      "    if (style != 0) {",
      "        mask *= edgePresence;",
      "    }",
      "    ",
      "    // 6. Apply Lighting",
      "    float highlightAmt = clamp(intensity, 0.0, 1.0) * (hiOpacity / 100.0) * mask;",
      "    float shadowAmt = clamp(-intensity, 0.0, 1.0) * (shOpacity / 100.0) * mask;",
      "    ",
      "    vec3 rgb = original.rgb;",
      "    ",
      "    // Apply Highlight",
      "    vec3 hiBlended = applyBlend(hiMode, rgb, hiColor);",
      "    rgb = mix(rgb, hiBlended, highlightAmt);",
      "    ",
      "    // Apply Shadow",
      "    vec3 shBlended = applyBlend(shMode, rgb, shColor);",
      "    rgb = mix(rgb, shBlended, shadowAmt);",
      "    ",
      "    // 7. Output Alpha",
      "    float outAlpha = original.a;",
      "    if (style != 0) {",
      "        float effectAlpha = max(highlightAmt, shadowAmt);",
      "        outAlpha = max(original.a, effectAlpha);",
      "    }",
      "    ",
      "    result = vec4(rgb, outAlpha);",
      "    normalOut = vec4(normal * 0.5 + 0.5, original.a);",
      "}"
    ],
    "inputs": [
      {
        "id": "inputTex",
        "name": "Input",
        "type": "sampler2D"
      },
      {
        "id": "style",
        "name": "Style",
        "type": "int"
      },
      {
        "id": "technique",
        "name": "Technique",
        "type": "int"
      },
      {
        "id": "depth",
        "name": "Depth",
        "type": "float"
      },
      {
        "id": "size",
        "name": "Size",
        "type": "float"
      },
      {
        "id": "soften",
        "name": "Soften",
        "type": "float"
      },
      {
        "id": "angle",
        "name": "Angle",
        "type": "float"
      },
      {
        "id": "altitude",
        "name": "Altitude",
        "type": "float"
      },
      {
        "id": "hiOpacity",
        "name": "Highlight Opacity",
        "type": "float"
      },
      {
        "id": "shOpacity",
        "name": "Shadow Opacity",
        "type": "float"
      },
      {
        "id": "hiColor",
        "name": "Highlight Color",
        "type": "vec3"
      },
      {
        "id": "shColor",
        "name": "Shadow Color",
        "type": "vec3"
      },
      {
        "id": "direction",
        "name": "Direction",
        "type": "int"
      },
      {
        "id": "hiMode",
        "name": "Highlight Mode",
        "type": "int"
      },
      {
        "id": "shMode",
        "name": "Shadow Mode",
        "type": "int"
      },
      {
        "id": "contour",
        "name": "Contour",
        "type": "sampler2D"
      },
      {
        "id": "detailTex",
        "name": "Texture",
        "type": "sampler2D"
      },
      {
        "id": "detailDepth",
        "name": "Texture Depth",
        "type": "float"
      }
    ],
    "outputs": [
      {
        "id": "result",
        "name": "Result",
        "type": "vec4"
      },
      {
        "id": "normalOut",
        "name": "Normal",
        "type": "vec4"
      }
    ],
    "outputType": "vec4",
    "uniforms": {
      "style": {
        "type": "int",
        "value": 0,
        "widget": "enum",
        "widgetConfig": {
          "enumOptions": [
            {
              "label": "Inner Bevel",
              "value": 0
            },
            {
              "label": "Outer Bevel",
              "value": 1
            },
            {
              "label": "Emboss",
              "value": 2
            },
            {
              "label": "Pillow Emboss",
              "value": 3
            }
          ]
        }
      },
      "technique": {
        "type": "int",
        "value": 0,
        "widget": "enum",
        "widgetConfig": {
          "enumOptions": [
            {
              "label": "Smooth",
              "value": 0
            },
            {
              "label": "Chisel Hard",
              "value": 1
            },
            {
              "label": "Chisel Soft",
              "value": 2
            }
          ]
        }
      },
      "contour": {
        "type": "sampler2D",
        "value": null,
        "widget": "curve",
        "widgetConfig": {
          "curvePoints": [
            {
              "x": 0,
              "y": 0
            },
            {
              "x": 1,
              "y": 1
            }
          ]
        }
      },
      "detailTex": {
        "type": "sampler2D",
        "value": null,
        "widget": "image"
      },
      "detailDepth": {
        "type": "float",
        "value": 0,
        "widget": "slider",
        "widgetConfig": {
          "min": -100,
          "max": 100,
          "step": 1
        }
      },
      "depth": {
        "type": "float",
        "value": 100,
        "widget": "slider",
        "widgetConfig": {
          "min": 1,
          "max": 1000,
          "step": 1
        }
      },
      "size": {
        "type": "float",
        "value": 5,
        "widget": "slider",
        "widgetConfig": {
          "min": 0,
          "max": 250,
          "step": 1
        }
      },
      "soften": {
        "type": "float",
        "value": 0,
        "widget": "slider",
        "widgetConfig": {
          "min": 0,
          "max": 32,
          "step": 1
        }
      },
      "angle": {
        "type": "float",
        "value": 30,
        "widget": "angle",
        "widgetConfig": {
          "min": 0,
          "max": 360,
          "step": 1
        }
      },
      "altitude": {
        "type": "float",
        "value": 30,
        "widget": "slider",
        "widgetConfig": {
          "min": 0,
          "max": 90,
          "step": 1
        }
      },
      "hiColor": {
        "type": "vec3",
        "value": [
          1,
          1,
          1
        ],
        "widget": "color"
      },
      "hiMode": {
        "type": "int",
        "value": 2,
        "widget": "enum",
        "widgetConfig": {
          "enumOptions": [
            {
              "label": "Normal",
              "value": 0
            },
            {
              "label": "Multiply",
              "value": 1
            },
            {
              "label": "Screen",
              "value": 2
            },
            {
              "label": "Overlay",
              "value": 3
            },
            {
              "label": "Linear Dodge",
              "value": 4
            },
            {
              "label": "Linear Burn",
              "value": 5
            }
          ]
        }
      },
      "hiOpacity": {
        "type": "float",
        "value": 75,
        "widget": "slider",
        "widgetConfig": {
          "min": 0,
          "max": 100,
          "step": 1
        }
      },
      "shColor": {
        "type": "vec3",
        "value": [
          0,
          0,
          0
        ],
        "widget": "color"
      },
      "shMode": {
        "type": "int",
        "value": 1,
        "widget": "enum",
        "widgetConfig": {
          "enumOptions": [
            {
              "label": "Normal",
              "value": 0
            },
            {
              "label": "Multiply",
              "value": 1
            },
            {
              "label": "Screen",
              "value": 2
            },
            {
              "label": "Overlay",
              "value": 3
            },
            {
              "label": "Linear Dodge",
              "value": 4
            },
            {
              "label": "Linear Burn",
              "value": 5
            }
          ]
        }
      },
      "shOpacity": {
        "type": "float",
        "value": 75,
        "widget": "slider",
        "widgetConfig": {
          "min": 0,
          "max": 100,
          "step": 1
        }
      },
      "direction": {
        "type": "int",
        "value": 0,
        "widget": "enum",
        "widgetConfig": {
          "enumOptions": [
            {
              "label": "Up",
              "value": 0
            },
            {
              "label": "Down",
              "value": 1
            }
          ]
        }
      }
    }
  }
}