{
  "id": "GAUSSIAN_BLUR",
  "label": "Blur",
  "category": "Filter",
  "locales": {
    "zh": {
      "Blur": "模糊",
      "Multi-mode blur: Gaussian, Directional, Radial, and Zoom.": "多模式模糊：高斯、定向、径向和缩放。",
      "mode": "模式",
      "strength": "强度",
      "samples": "采样数",
      "center": "中心",
      "angle": "角度",
      "Gaussian": "高斯模糊",
      "Direction": "定向模糊",
      "Rotation blur": "旋转模糊",
      "Zoom blur": "缩放模糊"
    }
  },
  "data": {
    "glsl": "void run(vec2 uv, sampler2D tex, int mode, float strength, int samples, vec2 center, float angle, out vec4 result) {\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n    \n    int count = samples;\n    if(count > 128) count = 128;\n    if(count < 2) count = 2;\n    \n    float rad = radians(angle);\n    vec2 dir = vec2(cos(rad), sin(rad));\n    float golden_angle = 2.39996323;\n\n    for (int i = 0; i < 128; i++) {\n        if (i >= count) break;\n        \n        float t = float(i) / float(count - 1); \n        float t_centered = t * 2.0 - 1.0;\n        float weight = 1.0;\n        vec2 coord = uv;\n        \n        if (mode == 0) { \n            float r = sqrt(float(i) / float(count)) * strength * 0.05;\n            float theta = float(i) * golden_angle;\n            vec2 offset = vec2(cos(theta), sin(theta)) * r;\n            coord += offset;\n        } else if (mode == 1) { \n            coord += dir * t_centered * strength * 0.1;\n        } else if (mode == 2) { \n            vec2 rel = uv - center;\n            float phi = t_centered * strength * 0.1;\n            float s = sin(phi);\n            float c = cos(phi);\n            vec2 rotated = vec2(rel.x * c - rel.y * s, rel.x * s + rel.y * c);\n            coord = center + rotated;\n        } else if (mode == 3) { \n            vec2 rel = uv - center;\n            float scale = 1.0 + (t_centered * strength * 0.2);\n            coord = center + rel * scale;\n        }\n        \n        color += texture(tex, coord) * weight;\n        total += weight;\n    }\n    \n    if (total == 0.0) {\n        result = texture(tex, uv);\n    } else {\n        result = color / total;\n    }\n}",
    "inputs": [
      {
        "id": "tex",
        "name": "tex",
        "type": "sampler2D"
      },
      {
        "id": "mode",
        "name": "mode",
        "type": "int"
      },
      {
        "id": "strength",
        "name": "strength",
        "type": "float"
      },
      {
        "id": "samples",
        "name": "samples",
        "type": "int"
      },
      {
        "id": "center",
        "name": "center",
        "type": "vec2"
      },
      {
        "id": "angle",
        "name": "angle",
        "type": "float"
      }
    ],
    "outputs": [
      {
        "id": "result",
        "name": "result",
        "type": "vec4"
      }
    ],
    "uniforms": {
      "tex": {
        "type": "sampler2D",
        "value": null
      },
      "mode": {
        "type": "int",
        "value": 0,
        "widgetConfig": {
          "min": 0,
          "max": 3,
          "enumOptions": [
            {
              "label": "Gaussian",
              "value": 0
            },
            {
              "label": "Direction",
              "value": 1
            },
            {
              "label": "Rotation blur",
              "value": 2
            },
            {
              "label": "Zoom blur",
              "value": 3
            }
          ]
        },
        "widget": "enum"
      },
      "strength": {
        "type": "float",
        "value": 0.5,
        "widgetConfig": {
          "min": 0,
          "max": 1
        }
      },
      "samples": {
        "type": "int",
        "value": 32,
        "widgetConfig": {
          "min": 2,
          "max": 128
        },
        "widget": "default"
      },
      "center": {
        "type": "vec2",
        "value": [
          0.5,
          0.5
        ],
        "widget": "pad",
        "widgetConfig": {
          "minX": 0,
          "minY": 0
        }
      },
      "angle": {
        "type": "float",
        "value": 0,
        "widgetConfig": {
          "min": 0,
          "max": 360,
          "visibleIf": {
            "uniform": "mode",
            "value": 1
          }
        }
      }
    },
    "outputType": "vec4"
  }
}