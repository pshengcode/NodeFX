{
    "id": "roughen_edges",
    "label": "Roughen Edges",
    "category": "Filter",
    "icon": "Waves",
    "description": "Distorts the edges of the image using fractal noise, similar to the After Effects effect.",
    "locales": {
        "zh": {
            "Roughen Edges": "粗糙边缘",
            "Texture": "纹理",
            "Scale": "缩放",
            "Strength": "强度",
            "Evolution": "演化",
            "Complexity": "复杂度",
            "Result": "结果"
        }
    },
    "data": {
        "glsl": [
            "// Random function",
            "float hash(vec2 p) {",
            "    return fract(sin(dot(p, vec2(12.9898, 78.233))) * 43758.5453);",
            "}",
            "",
            "// Value Noise 2D",
            "float noise(vec2 p) {",
            "    vec2 i = floor(p);",
            "    vec2 f = fract(p);",
            "    f = f * f * (3.0 - 2.0 * f);",
            "    float a = hash(i);",
            "    float b = hash(i + vec2(1.0, 0.0));",
            "    float c = hash(i + vec2(0.0, 1.0));",
            "    float d = hash(i + vec2(1.0, 1.0));",
            "    return mix(mix(a, b, f.x), mix(c, d, f.x), f.y);",
            "}",
            "",
            "// FBM",
            "float fbm(vec2 p, int octaves) {",
            "    float v = 0.0;",
            "    float a = 0.5;",
            "    vec2 shift = vec2(100.0);",
            "    mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.5));",
            "    for (int i = 0; i < 8; ++i) {",
            "        if(i >= octaves) break;",
            "        v += a * noise(p);",
            "        p = rot * p * 2.0 + shift;",
            "        a *= 0.5;",
            "    }",
            "    return v;",
            "}",
            "",
            "void run(vec2 uv, sampler2D tDiffuse, float scale, float strength, float evolution, int octaves, out vec4 result) {",
            "    // Calculate noise based displacement",
            "    vec2 noisePos = uv * scale + vec2(evolution * 0.1);",
            "    ",
            "    float n1 = fbm(noisePos, octaves);",
            "    float n2 = fbm(noisePos + vec2(12.34, 56.78), octaves);",
            "    ",
            "    vec2 displacement = (vec2(n1, n2) - 0.5) * 2.0;",
            "    ",
            "    // Apply strength (scaled down for usability)",
            "    vec2 distortedUv = uv + displacement * (strength * 0.005);",
            "    ",
            "    result = texture(tDiffuse, distortedUv);",
            "}",
            "",
            "void run(vec2 uv, sampler2D tDiffuse, float noise, float strength, out vec4 result) {",
            "    // Use external noise (0..1) to drive displacement",
            "    float n1 = noise;",
            "    // Use sin() to generate a smooth second component from the input noise",
            "    // fract() would cause high-frequency noise artifacts",
            "    float n2 = sin(noise * 6.28318);",
            "    ",
            "    vec2 displacement = (vec2(n1, n2) - 0.5) * 2.0;",
            "    vec2 distortedUv = uv + displacement * (strength * 0.005);",
            "    ",
            "    result = texture(tDiffuse, distortedUv);",
            "}"
        ],
        "outputType": "vec4",
        "inputs": [
            { "id": "tDiffuse", "name": "Texture", "type": "sampler2D" },
            { "id": "scale", "name": "Scale", "type": "float" },
            { "id": "strength", "name": "Strength", "type": "float" },
            { "id": "evolution", "name": "Evolution", "type": "float" },
            { "id": "octaves", "name": "Complexity", "type": "int" },
            { "id": "noise", "name": "Noise Data", "type": "float" }
        ],
        "outputs": [
            { "id": "result", "name": "Result", "type": "vec4" }
        ],
        "uniforms": {
            "scale": { "type": "float", "value": 50.0, "widgetConfig": { "min": 1.0, "max": 200.0, "step": 1.0 } },
            "strength": { "type": "float", "value": 5.0, "widgetConfig": { "min": 0.0, "max": 50.0, "step": 0.1 } },
            "evolution": { "type": "float", "value": 0.0, "widgetConfig": { "step": 0.1 } },
            "octaves": { "type": "int", "value": 3, "widgetConfig": { "min": 1, "max": 8, "step": 1 } }
        }
    }
}