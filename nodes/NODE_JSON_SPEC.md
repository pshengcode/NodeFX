
# Shader Node JSON Specification

????? `nodes/library/*.json` ?????????????????????? [utils/schemas.ts](../utils/schemas.ts) ? [types.ts](../types.ts)??

## 1. ?????ShaderNodeDefinition?

| ?? | ?? | ?? | ?? |
| --- | --- | --- | --- |
| `id` | `string` | ? | ??????????????? `BLEND`? |
| `label` | `string` | ? | ????????? `locales` ??? |
| `category` | `string` | ? | ??????????? |
| `icon` | `string` | ? | Lucide icon ????? UI? |
| `description` | `string` | ? | ???? |
| `locales` | `Record<string, Record<string, string>>` | ? | ????? |
| `data` | `object` | ? | ??????????? |

**category ????????????**

`Input` / `Generator` / `Math` / `Vector` / `Color` / `Filter` / `Effect` / `Utility` / `Output` / `Network` / `Custom` / `User`

## 2. data ???ShaderNodeData?

| ?? | ?? | ?? | ?? |
| --- | --- | --- | --- |
| `glsl` | `string \| string[]` | ? | GLSL ??????????????????? `void run(...)` |
| `inputs` | `NodeInput[]` | ? | ?????? |
| `outputs` | `NodeOutput[]` | ? | ?????????????? |
| `uniforms` | `Record<string, UniformVal>` | ? | ?? input ??????? UI ???? |
| `outputType` | `GLSLType` | ? | ???????????????????????? |
| `autoType` | `boolean` | ? | ??????/?????????? CustomShader ???? |

### 2.1 ????

```ts
type GLSLType =
  | 'float' | 'int' | 'bool' | 'uint'
  | 'vec2' | 'vec3' | 'vec4'
  | 'uvec2' | 'uvec3' | 'uvec4'
  | 'mat2' | 'mat3' | 'mat4'
  | 'sampler2D' | 'samplerCube'
  | 'vec2[]';

type NodeInput = { id: string; name: string; type: GLSLType };
type NodeOutput = { id: string; name: string; type: GLSLType };
```

### 2.2 uniforms ? UI ??

`uniforms` ? key ??? `inputs[].id` ???

```json
"uniforms": {
  "intensity": {
    "type": "float",
    "value": 0.5,
    "widget": "slider",
    "widgetConfig": { "min": 0, "max": 1, "step": 0.01 }
  }
}
```

**widget ????????????**

`default` / `slider` / `number` / `angle` / `pad` / `color` / `curve` / `gradient` / `image` / `toggle` / `enum` / `range` / `bezier_grid` / `hidden`

**value ? JSON ?????? schema ???**

- `number`
- `boolean`
- `number[]`?? `vec2/vec3/vec4/mat*` ??
- `number[][]`??? `vec2[]`?
- `string`????? id?`asset://...` / `builtin://...`?
- `null`??? sampler ?????

### 2.3 ?????visibleIf?

`widgetConfig.visibleIf` ??????/???????

```json
"widgetConfig": {
  "visibleIf": {
    "uniform": "mode",
    "value": 1
  }
}
```

???
- `uniform`??? uniform id
- `value`????????/????????
- `notValue`?????????/????????????? `value` ????

## 3. GLSL ???Overloads?

?????? GLSL ?????? `void run(...)` ?????????????
????? UI ????????????????? GLSL ????????

```glsl
//[Item("Float", 0)]
void run(float x, out float outVal) { outVal = x; }

//[Item("Vec3", 1)]
void run(vec3 x, out vec3 outVal) { outVal = x; }
```

## 4. ????

```json
{
  "id": "VIGNETTE",
  "label": "Vignette",
  "category": "Filter",
  "description": "Adds a dark border around the image",
  "data": {
    "glsl": "void run(vec2 uv, sampler2D inputTex, float intensity, out vec4 result) { vec4 c = texture(inputTex, uv); result = vec4(c.rgb * intensity, c.a); }",
    "inputs": [
      { "id": "inputTex", "name": "Input", "type": "sampler2D" },
      { "id": "intensity", "name": "Intensity", "type": "float" }
    ],
    "outputs": [
      { "id": "result", "name": "Result", "type": "vec4" }
    ],
    "outputType": "vec4",
    "uniforms": {
      "intensity": { "type": "float", "value": 1, "widget": "slider", "widgetConfig": { "min": 0, "max": 2, "step": 0.01 } }
    }
  }
}
```

