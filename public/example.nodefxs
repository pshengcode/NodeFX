{"nodes":[{"id":"IMAGE_1765015207882_792","type":"customShader","position":{"x":40,"y":156.15073048206386},"zIndex":10,"data":{"glsl":"void run(vec2 uv, vec2 uv_in, sampler2D image, out vec4 result) {\n  vec2 coord = (uv_in == vec2(0.0)) ? uv : uv_in;\n  result = texture2D(image, coord);\n}","inputs":[{"id":"uv_in","name":"uv_in","type":"vec2"},{"id":"image","name":"image","type":"sampler2D"}],"outputType":"vec4","outputs":[{"id":"result","name":"result","type":"vec4"}],"uniforms":{"uv_in":{"type":"vec2","value":[0,0]},"image":{"type":"sampler2D","value":"builtin://texture/n"}},"label":"Image Loader","category":"Generator","definitionId":"IMAGE","locales":{"zh":{"Image Loader":"图片加载器","Loads an external image texture. Optional UV input.":"加载外部图片纹理。可选 UV 输入。","image":"图片"}},"preview":false,"resolution":{"w":512,"h":512},"scopeId":"root"},"width":378,"height":231,"selected":false,"positionAbsolute":{"x":-405.1357813464216,"y":401.07711910438877},"parentId":"group-1765015241143"},{"id":"ADVANCED_BLOOM_1765015210347_814","type":"customShader","position":{"x":506.513668074766,"y":70},"zIndex":10,"data":{"glsl":"void run(vec2 uv, sampler2D tex, float intensity, float threshold, float radius, float scatter, int samples, vec2 shift, vec3 tint, int glow_only, out vec4 result) {\n    vec4 original = texture(tex, uv);\n    vec3 glowSum = vec3(0.0);\n    float totalWeight = 0.0;\n    \n    int count = clamp(samples, 16, 1000);\n    float aspect = 1.0;\n    if (u_resolution.y > 0.0) aspect = u_resolution.x / u_resolution.y;\n\n    float knee = 0.1 + scatter * 0.1; \n\n    for (int i = 0; i < 1000; i++) {\n        if (i >= count) break;\n        \n        float t = float(i) / float(count - 1);\n        float theta = float(i) * 2.3999632; // Golden Angle\n        \n        float r_dist = pow(t, 1.0 - (scatter * 0.5)); \n        float r = radius * 0.01 * r_dist;\n        \n        vec2 offset = vec2(sin(theta), cos(theta)) * r;\n        offset.x /= aspect;\n        offset += shift * 0.01;\n        \n        // Multi-scale sampling using textureLod\n        float lod = scatter * 6.0 * t;\n        vec3 col = textureLod(tex, uv + offset, lod).rgb;\n        \n        float br = max(col.r, max(col.g, col.b));\n        float rq = clamp((br - threshold + knee) / (2.0 * knee), 0.0, 1.0);\n        float factor = rq * rq;\n        \n        if (br < threshold - knee) factor = 0.0;\n        \n        float sigma = 0.15 + scatter * 0.5;\n        float weight = exp(-t*t / (2.0 * sigma * sigma));\n        \n        glowSum += col * factor * weight;\n        totalWeight += weight;\n    }\n    \n    vec3 glow = vec3(0.0);\n    if (totalWeight > 0.0) {\n        glow = (glowSum / totalWeight) * intensity;\n    }\n    \n    glow *= tint;\n    \n    if (glow_only == 1) {\n        result = vec4(glow, 1.0);\n    } else {\n        result = vec4(original.rgb + glow, original.a);\n    }\n}","inputs":[{"id":"tex","name":"tex","type":"sampler2D"},{"id":"intensity","name":"intensity","type":"float"},{"id":"threshold","name":"threshold","type":"float"},{"id":"radius","name":"radius","type":"float"},{"id":"scatter","name":"scatter","type":"float"},{"id":"samples","name":"samples","type":"int"},{"id":"shift","name":"shift","type":"vec2"},{"id":"tint","name":"tint","type":"vec3"},{"id":"glow_only","name":"glow_only","type":"int"}],"outputs":[{"id":"result","name":"result","type":"vec4"}],"uniforms":{"tex":{"type":"sampler2D","value":""},"intensity":{"type":"float","value":1.84,"widgetConfig":{"min":0,"max":10}},"threshold":{"type":"float","value":0.6,"widgetConfig":{"min":0,"max":1}},"radius":{"type":"float","value":21.1,"widgetConfig":{"min":0,"max":100}},"scatter":{"type":"float","value":0.56,"widgetConfig":{"min":0,"max":1}},"samples":{"type":"int","value":1000,"widgetConfig":{"min":16,"max":1000},"widget":"default"},"shift":{"type":"vec2","value":[0,0],"widget":"pad","widgetConfig":{"minX":-1,"minY":-1}},"tint":{"type":"vec3","value":[0,1,0.984313725490196],"widget":"color"},"glow_only":{"type":"int","value":0,"widget":"toggle"}},"outputType":"vec4","label":"Adv. Bloom","category":"Filter","definitionId":"ADVANCED_BLOOM","locales":{"zh":{"Adv. Bloom":"高级泛光","Physically based bloom with multi-scale spiral sampling.":"基于物理的多尺度螺旋采样泛光效果。","intensity":"强度","threshold":"阈值","radius":"半径","scatter":"散射","samples":"采样数","shift":"偏移","tint":"色调","glow_only":"仅发光"}},"preview":false,"resolution":{"w":512,"h":512},"scopeId":"root"},"width":302,"height":584,"selected":false,"positionAbsolute":{"x":61.37788672834438,"y":314.9263886223249},"dragging":false,"parentId":"group-1765015241143"},{"id":"group-1765015241143","type":"group","position":{"x":-445.1357813464216,"y":244.9263886223249},"style":{"width":848.513668074766,"height":694},"data":{"label":"Filter Bloom","description":"glow bloom effect","preview":false,"resolution":{"w":512,"h":512}},"selected":false,"zIndex":-10,"width":849,"height":694,"positionAbsolute":{"x":-445.1357813464216,"y":244.9263886223249},"dragging":false},{"id":"1765015272143_0_ayopz","type":"customShader","position":{"x":40,"y":83.54860192474212},"zIndex":10,"data":{"glsl":"void run(vec2 uv, vec2 uv_in, sampler2D image, out vec4 result) {\n  vec2 coord = (uv_in == vec2(0.0)) ? uv : uv_in;\n  result = texture2D(image, coord);\n}","inputs":[{"id":"uv_in","name":"uv_in","type":"vec2"},{"id":"image","name":"image","type":"sampler2D"}],"outputType":"vec4","outputs":[{"id":"result","name":"result","type":"vec4"}],"uniforms":{"uv_in":{"type":"vec2","value":[0,0]},"image":{"type":"sampler2D","value":"builtin://texture/n"}},"label":"Image Loader","category":"Generator","definitionId":"IMAGE","locales":{"zh":{"Image Loader":"图片加载器","Loads an external image texture. Optional UV input.":"加载外部图片纹理。可选 UV 输入。","image":"图片"}},"preview":false,"resolution":{"w":512,"h":512}},"width":378,"height":231,"selected":false,"positionAbsolute":{"x":-409.4925569153677,"y":1183.0443015775768},"parentId":"group-1765015291967","dragging":false},{"id":"rgb_offset_1765015279235_245","type":"customShader","position":{"x":525.4320652460519,"y":70},"zIndex":10,"data":{"glsl":"void run(vec2 uv, sampler2D image, int mode, int control_mode, vec2 offset_unified, vec2 offset_r, vec2 offset_g, vec2 offset_b, vec2 center, out vec4 output_color) {\n    vec2 uv_r = uv;\n    vec2 uv_g = uv;\n    vec2 uv_b = uv;\n\n    if (mode == 0) { // Linear\n        if (control_mode == 0) { // Unified\n            uv_r = uv - offset_unified;\n            uv_g = uv;\n            uv_b = uv + offset_unified;\n        } else { // Separate\n            uv_r = uv - offset_r;\n            uv_g = uv - offset_g;\n            uv_b = uv - offset_b;\n        }\n    } else { // Radial\n        vec2 dir = uv - center;\n        if (control_mode == 0) { // Unified\n            uv_r = uv - dir * offset_unified;\n            uv_g = uv;\n            uv_b = uv + dir * offset_unified;\n        } else {\n            uv_r = uv - dir * offset_r;\n            uv_g = uv - dir * offset_g;\n            uv_b = uv - dir * offset_b;\n        }\n    }\n\n    float r = texture(image, uv_r).r;\n    float g = texture(image, uv_g).g;\n    float b = texture(image, uv_b).b;\n    float a = texture(image, uv).a;\n\n    output_color = vec4(r, g, b, a);\n}","inputs":[{"id":"image","type":"sampler2D","name":"Image"},{"id":"mode","type":"int","name":"Mode"},{"id":"control_mode","type":"int","name":"Control Mode"},{"id":"offset_unified","type":"vec2","name":"Offset (Unified)"},{"id":"offset_r","type":"vec2","name":"Offset R"},{"id":"offset_g","type":"vec2","name":"Offset G"},{"id":"offset_b","type":"vec2","name":"Offset B"},{"id":"center","type":"vec2","name":"Center"}],"outputs":[{"id":"output","type":"vec4","name":"Output"}],"uniforms":{"mode":{"type":"int","value":0,"widget":"enum","widgetConfig":{"options":[{"label":"Linear","value":0},{"label":"Radial","value":1}],"enumOptions":[{"label":"Line","value":0},{"label":"Scale","value":1}]}},"control_mode":{"type":"int","value":0,"widget":"enum","widgetConfig":{"options":[{"label":"Unified","value":0},{"label":"Separate","value":1}],"enumOptions":[{"label":"unified","value":0},{"label":"rgb","value":1}]}},"offset_unified":{"type":"vec2","value":[-0.01,0.01],"visibleIf":{"control_mode":0},"widget":"pad","widgetConfig":{"minX":-0.1,"minY":-0.1,"maxX":0.1,"maxY":0.1,"visibleIf":{"uniform":"control_mode","value":0}}},"offset_r":{"type":"vec2","value":[0,0],"visibleIf":{"control_mode":1},"widgetConfig":{"visibleIf":{"uniform":"control_mode","value":1},"minX":-0.2,"minY":-0.2,"maxX":0.2,"maxY":0.2},"widget":"pad"},"offset_g":{"type":"vec2","value":[0,0],"visibleIf":{"control_mode":1},"widgetConfig":{"visibleIf":{"uniform":"control_mode","value":1},"minX":-0.2,"maxX":0.2,"minY":-0.2,"maxY":0.2},"widget":"pad"},"offset_b":{"type":"vec2","value":[0,0],"visibleIf":{"control_mode":1},"widgetConfig":{"visibleIf":{"uniform":"control_mode","value":1},"maxX":0.2,"minX":-0.2,"minY":-0.2,"maxY":0.2},"widget":"pad"},"center":{"type":"vec2","value":[0.5,0.5],"visibleIf":{"mode":1},"widgetConfig":{"visibleIf":{"uniform":"mode","value":1}},"widget":"pad"}},"outputType":"vec4","label":"RGB Offset","category":"Filter","definitionId":"rgb_offset","locales":{"zh":{"RGB Offset":"RGB偏移","Image":"图像","Mode":"模式","Control Mode":"控制模式","Offset (Unified)":"偏移(统一)","Offset R":"偏移R","Offset G":"偏移G","Offset B":"偏移B","Center":"中心","Output":"输出"}},"preview":false,"resolution":{"w":512,"h":512},"scopeId":"root"},"width":309,"height":289,"selected":false,"positionAbsolute":{"x":75.93950833068425,"y":1169.4956996528347},"parentId":"group-1765015291967"},{"id":"group-1765015291967","type":"group","position":{"x":-449.4925569153677,"y":1099.4956996528347},"style":{"width":874.4320652460519,"height":399},"data":{"label":"Filter RGB-offset","description":"","resolution":{"w":512,"h":512},"preview":false},"selected":false,"zIndex":-10,"width":874,"height":399,"positionAbsolute":{"x":-449.4925569153677,"y":1099.4956996528347},"dragging":false}],"edges":[{"source":"IMAGE_1765015207882_792","sourceHandle":"result","target":"ADVANCED_BLOOM_1765015210347_814","targetHandle":"tex","type":"smart","animated":false,"id":"reactflow__edge-IMAGE_1765015207882_792result-ADVANCED_BLOOM_1765015210347_814tex","selected":false},{"source":"1765015272143_0_ayopz","sourceHandle":"result","target":"rgb_offset_1765015279235_245","targetHandle":"image","type":"smart","animated":false,"id":"reactflow__edge-1765015272143_0_ayopzresult-rgb_offset_1765015279235_245image","selected":false}]}